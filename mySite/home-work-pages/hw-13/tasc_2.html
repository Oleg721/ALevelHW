<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Recipe</title>

  <script>

      let pan = [];
      let fryingPan = [];
      const ingredientNamePattern = /^([A-Za-z]+\s+){1,3}\d+$/;
      const ingredientList = {
          "meet"            : "450",
          "meet products"   : "300",
          "vegetable Oil"   : "2",
          "clove of Garlic" : "2-4",
          "bulb"            : "1",
          "tomato paste"    : "1",
          "pickles"         : "2-4",
          "olives"          : "to taste",
          "salt"            : "to taste",
          "paper"           : "to taste",
          "spices"          : "to taste",
          "green"           : "to taste",
      };

      const ingredientValue = {
        "gram"   : ["meet",
                    "meet products",
                    "salt",
                    "paper",
                    "spices",
                    "green"],

        "tbsp"   : ["vegetable Oil",
                   "tomato paste"],

        "pieces" : ["clove of Garlic",
                    "bulb",
                    "pickles",
                    "olives"],
      }




    let stove = {
    }


    function makeSolyanka(ingredientList, ingredientPattern){
      prepareIngredients(ingredientList, ingredientPattern);
    }


    function prepareIngredients(ingredientList, ingredientPattern) {

      let ingredient = null;
      let ingredientArr = [];
      let ingredientName = "";
      let ingredientQuantity = 0;

        while (ingredient != "exit"){
            ingredient = userEnterIngredientInput();
            /*pattern matching*/
            if (isIngredientPatternMatching(ingredient, ingredientPattern))
                [ingredientName, ingredientQuantity] = ingredient.split(/\s+(?=\d+)/);
            else{
                massageOutput("===> the entered value does not match the pattern ");
                continue;
            }

            /*check for content in the list of ingredients*/
            if (ingredientList[ingredientName])
                ingredient = new createIngredientObject(ingredientName,
                                                        ingredientQuantity,
                                                        getIngredientValueByName(ingredientName, ingredientValue));
             else{
                massageOutput("===> there is no such ingredient in the recipe");
                continue;
            }


            if (checkIngredientByName(ingredient, ingredientArr)){
                if(+ingredientList[ingredient.name] === findQuantityIngredientByName(ingredient, ingredientArr)){
                    massageOutput("===> the ingredient is in full");
                    continue;
                } else {
/*Refactoring*/
                    let ingQuantity = findQuantityIngredientByName(ingredient, ingredientArr)
                    ingredient.quantity = +ingredient.quantity + ingQuantity;
                    ingredientArr.splice(ingredientArr.indexOf(findIngredientByName(ingredient, ingredientArr)));
                    checkQuantityAddIngredient(ingredient, ingredientArr, ingredientList);
/*Refactoring*/
                }

            } else {
                checkQuantityAddIngredient(ingredient, ingredientArr, ingredientList);
            }



            console.dir(ingredientArr);
        }

      return ingredientArr
    }


    function getIngredientValueByName(ingredientName, ingredientValue){

        for (let key in ingredientValue){
              if (ingredientValue[key].includes(ingredientName))
                  return key;
        }
        return ""
    }


    function printIngredientList(ingredientList){

        let value = "\n===================";

        for (let key in ingredientList){
            value = value + "\n"+ key +
                      " - " + ingredientList[key] +
                      " " + getIngredientValueByName(key);
        }
        return value;
    }


    function userEnterIngredientInput() {
          return prompt("please add an ingredient from the list in " +
              "format [ingredient value] for example - \"meet 500\" :"
              + printIngredientList(ingredientList), "meet 777");
    }


    function isIngredientPatternMatching(userIngredient, ingredientPattern) {
          if (!userIngredient) return false;
          if (!userIngredient.match(ingredientPattern)) return false;
        return true;
    }


    function createIngredientObject(ingredientName, ingredientQuantity, value){
          this.name = ingredientName;
          this.quantity = ingredientQuantity;
          this.value = value;
          this.washed = false;
          this.sliced = false;
    }


    function checkIngredientByName(ingredientObj, ingredientsArr) {
          if (ingredientsArr.length === 0) return false;
          for (let key of ingredientsArr){
              if (key.name === ingredientObj.name) return true;
          }
          return false
    }

      function findQuantityIngredientByName(ingredient, ingredientsArr) {
          for (let key of ingredientsArr){
              if (key.name === ingredient.name) return key.quantity;
          }
      }

      function findIngredientByName(ingredient, ingredientsArr) {
          if (ingredientsArr.length === 0) return null;
          for (let key of ingredientsArr){
              if (key.name === ingredient.name) return key;
          }
          return null;
      }


    function compareQuantityByList(ingredient, ingredientList) {

        let ingredientQuantity = ingredient.quantity;
        let ingredientName = ingredient.name;
        let valueByList = Number(ingredientList[ingredientName]);

        if( ingredientQuantity > valueByList) return 1;
        else if (ingredientQuantity < valueByList) return -1;
        return 0;
    }

    function checkQuantityAddIngredient(ingredient, ingredientArr, ingredientList) {

        switch (compareQuantityByList(ingredient, ingredientList)) {

        case -1:
            ingredient.quantity =+ ingredient.quantity;
            if (compareQuantityByList(ingredient, ingredientList) === 0) {
                ingredientArr.push(ingredient);
                console.log(`Ingredient ${ingredient.name} has been prepared`);
            } else {
                addNotAll(ingredient, ingredientArr, ingredientList)
            }
            break;

        case 0:
            ingredientArr.push(ingredient);
            console.log(`Ingredient ${ingredient.name} has been prepared`);
            break;

        case 1:
            let i = ingredient.quantity - ingredientList[ingredient.name];
            ingredient.quantity = ingredientList[ingredient.name];
            ingredientArr.push(ingredient);
            console.log(`Ingredient ${ingredient.name} has been prepared`+
                `but left ${i} ${ingredient.value}`);
            break;
    }

    }

    function addNotAll(ingredient, ingredientObjs, ingredientList){
        let i = ingredientList[ingredient.name] - ingredient.quantity ;
        ingredientObjs.push(ingredient);
        console.log(`Ingredient ${ingredient.name} has been prepared`+
            `but ${i} are missing`);
    }

    function massageOutput(massage) {
          console.log(massage);
    }


      makeSolyanka(ingredientList, ingredientNamePattern);

  </script>
</head>
<body>

</body>
</html>